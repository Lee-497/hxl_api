# 华信联库存汇总报表系统

## 项目描述
华信联库存汇总报表系统是一个用于处理和分析库存数据的自动化工具，支持多数据源关联、数据清洗、透视分析和报表生成。

## 主要功能
- 📊 **库存数据处理**：自动加载和处理库存查询数据
- 🏪 **门店属性关联**：关联门店商品属性（停购、停止要货状态）
- 📋 **商品分类管理**：关联组织商品档案，补充商品分类信息
- 👥 **采购责任人匹配**：根据商品分类匹配采购责任人
- 🚫 **数据过滤**：自动剔除指定仓库和商品分类
- 📈 **透视分析**：将门店数据从行转换为列，便于分析
- 📄 **报表生成**：生成带时间戳的Excel报表文件

## 系统架构
```
xlb_api/
├── processing/                 # 数据处理模块
│   ├── inventory_summary_report.py  # 库存汇总报表核心逻辑
│   └── ...
├── storage/                   # 数据存储目录
│   ├── downloads/            # 原始数据文件
│   ├── processed/            # 处理后的报表文件
│   ├── logs/                # 系统日志
│   └── reference/           # 参考数据文件
├── core/                     # 核心模块
├── utils/                    # 工具模块
├── config/                   # 配置文件
└── main.py                   # 程序入口

```

## 数据流程
1. **数据加载**：从Excel文件加载库存、商品档案、门店属性等数据
2. **数据关联**：通过商品代码、门店等关键字段进行数据关联
3. **数据清洗**：剔除指定仓库（退货仓、中转仓）和商品分类（冷藏、冷冻食品）
4. **属性匹配**：为每个商品匹配停购、停止要货状态
5. **透视转换**：将门店字段展开为列，便于横向对比分析
6. **报表输出**：生成Excel格式的汇总报表

## 技术特点
- ✅ **数据一致性保证**：确保同一商品在不同门店的属性状态一致
- ✅ **空值智能修复**：从原始数据源补全透视表中的空值
- ✅ **详细日志记录**：完整记录数据处理过程和统计信息
- ✅ **错误处理机制**：优雅处理数据缺失和异常情况
- ✅ **灵活配置**：支持配置剔除的仓库和商品分类

## 环境要求
- Python 3.8+
- pandas >= 1.3.0
- openpyxl >= 3.0.0
- 其他依赖见 requirements.txt

## 快速开始

### 1. 克隆项目
```bash
git clone https://github.com/Lee-497/hxl_api.git
cd hxl_api
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 配置模块（main.py）

**最简单的配置**（销售分析）：
```python
# 启用销售分析模块
MODULE_SWITCHES = {
    "sales_analysis": True,
}

# 配置参数（使用预定义模板）
MODULE_PARAMS = {
    "sales_analysis": {
        "template_name": "dairy_cold_drinks",  # 冷藏乳饮
    }
}

# 启用报表加工
PROCESSING_SWITCHES = {
    "sales_analysis_report": True,
}
```

### 4. 运行程序
```bash
python main.py
```

### 5. 查看结果
- **原始数据**: `storage/downloads/商品销售数据_*.xlsx`
- **分析报表**: `storage/processed/销售分析报表_*.xlsx`

📖 **更多配置示例**: 查看 `QUICK_START.md`

## 配置说明

### 剔除仓库配置
在 `inventory_summary_report.py` 中的 `EXCLUDED_WAREHOUSES` 列表：
```python
EXCLUDED_WAREHOUSES = [
    "广东从化退货仓",
    "广东东莞二仓退货仓", 
    "东莞中转仓"
]
```

### 剔除分类配置
在 `filter_excluded_categories` 函数中的 `EXCLUDED_CATEGORIES` 列表：
```python
EXCLUDED_CATEGORIES = ['冷藏食品', '冷冻食品']
```

## 日志说明
系统运行时会生成详细的日志信息，包括：
- 数据加载统计
- 关联匹配结果
- 数据过滤统计
- 空值修复情况
- 透视转换结果

## 开发团队
- 开发者：Lee-497
- 项目类型：企业内部数据处理工具
- 更新时间：2025年11月

## 📚 文档导航

- 📖 **快速开始**: `QUICK_START.md` - 常用配置场景和示例
- 🏗️ **架构设计**: `ARCHITECTURE.md` - 系统架构和设计原理
- ⚙️ **配置指南**: `CONFIG_GUIDE.md` - 详细的配置说明
- 📝 **优化总结**: `REFACTORING_SUMMARY.md` - 架构优化说明

## 版本历史
- **v2.1.0** (2025-11-15) - 配置设计优化，职责分离
- **v2.0.0** (2025-11-15) - 模块化架构重构，统一接口
- **v1.2.0** - 添加分类过滤和数据一致性保证
- **v1.1.0** - 添加门店属性关联和空值修复
- **v1.0.0** - 基础库存汇总功能

## 许可证
本项目为企业内部使用工具，请遵守相关使用规范。